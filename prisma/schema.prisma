generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  phoneNo   String
  name      String
  password  String
  age       Int
  role      Role     @default(PATIENT)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  patient     Patient?
  doctor      Doctor?
  admin       Admin?
  userAddress UserAddress?
}

model UserAddress {
  id        String   @id @default(cuid())
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  address   String
  city      String
  state     String
  pinCode   Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum Gender {
  MALE
  FEMALE
  BINARY
}

model Patient {
  id                 String   @id @default(cuid())
  userId             String   @unique
  medicalHistory     String   @default("")
  allergies          String   @default("")
  currentMedications String   @default("")

  doctorRelations    DoctorPatientRelation[]

  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  user               User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Doctor {
  id              String           @id @default(cuid())
  userId          String           @unique
  user            User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  specialty       Specialty
  experience      Int              @default(0)
  qualifications  Qualification[]
  fees            Int              @default(0)

  // ✅ Doctor → Schedule (1 to 1)
  schedule        Schedule?

  // ✅ Doctor → Leave (1 to many)
  leaves          Leave[]

  patientRelations DoctorPatientRelation[]

  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
}

model DoctorPatientRelation {
  id        String   @id @default(cuid())

  doctorId  String
  patientId String

  doctor    Doctor   @relation(fields: [doctorId], references: [id], onDelete: Cascade)
  patient   Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)

  messages  ChatMessage[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([doctorId, patientId])
}

model ChatMessage {
  id          String       @id @default(cuid())
  relationId  String
  relation    DoctorPatientRelation @relation(fields: [relationId], references: [id], onDelete: Cascade)

  sender      ChatSender
  content     String
  sentAt      DateTime     @default(now())
  readAt      DateTime?

  @@index([relationId])
}

enum ChatSender {
  DOCTOR
  PATIENT
}

model Schedule {
  id             String   @id @default(cuid())
  doctorId       String   @unique
  weeklySchedule Json
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  doctor         Doctor   @relation(fields: [doctorId], references: [id], onDelete: Cascade)
}


model Leave {
  id        String   @id @default(cuid())
  doctorId  String
  doctor    Doctor   @relation(fields: [doctorId], references: [id], onDelete: Cascade)

  reason    String
  startDate DateTime
  endDate   DateTime

  applyAt   DateTime @default(now())
}

enum Specialty {
  CARDIOLOGIST
  DERMATOLOGIST
  PEDIATRICIAN
  NEUROLOGIST
  NEPHROLOGIST
  GASTROENTEROLOGIST
  ENDOCRINOLOGIST
  PULMONOLOGIST
  ONCOLOGIST
  ORTHOPEDIC
  OPHTHALMOLOGIST
  OTOLARYNGOLOGIST
  UROLOGIST
  RHEUMATOLOGIST
  PSYCHIATRIST
  PSYCHOLOGIST
  GENERAL_PHYSICIAN
  GENERAL_SURGEON
  RADIOLOGIST
  PATHOLOGIST
  HEMATOLOGIST
  DENTIST
  GYNECOLOGIST
  OBSTETRICIAN
  PLASTIC_SURGEON
  VASCULAR_SURGEON
  CARDIOTHORACIC_SURGEON
  DERMATOSURGEON
  INFECTIOUS_DISEASE_SPECIALIST
  IMMUNOLOGIST
  ANESTHESIOLOGIST
  EMERGENCY_MEDICINE
  SPORTS_MEDICINE
  PAIN_MEDICINE
  CRITICAL_CARE
  PHYSIOTHERAPIST
  NUTRITIONIST
}

enum Qualification {
  MBBS
  BDS
  BPT
  BHMS
  BAMS
  MD
  MS
  DNB
  MDS
  DM
  MCH
  MPH
  MBA_HM
  PHD
  DO
  FELLOWSHIP
  PGD
}

enum Role {
  PATIENT
  DOCTOR
  ADMIN
}
