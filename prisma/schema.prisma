generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  phoneNo   String
  name      String
  password  String
  age       Int
  role      Role     @default(PATIENT)
  
  gender    Gender   @default(MALE)
  admin     Admin?
  doctor    Doctor?
  patient   Patient?
  useraddress   UserAddress?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Patient {
  id                 String   @id @default(cuid())
  userId             String   @unique
  medicalHistory     String   @default("")
  allergies          String   @default("")
  currentMedications String   @default("")
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  user               User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  doctorRelations    DoctorPatientRelation[]
}

model Doctor {
  id             String          @id @default(cuid())
  userId         String          @unique
  specialty      Specialty
  experience     Int             @default(0)
  qualifications Qualification[]
  fees           Int             @default(0)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  user           User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  leaves         Leave[]
  schedule       Schedule?
  patientRelations DoctorPatientRelation[]
}

model UserAddress {
  id        String   @id @default(cuid())
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  address   String
  city      String
  state     String
  pinCode   Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
}

model DoctorPatientRelation {
  id        String   @id @default(cuid())
  doctorId  String
  patientId String
  doctor  Doctor  @relation(fields: [doctorId], references: [id], onDelete: Cascade)
  patient Patient @relation(fields: [patientId], references: [id], onDelete: Cascade)


  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([doctorId, patientId])
  @@index([doctorId])
  @@index([patientId])
}

model Schedule {
  id             String   @id @default(cuid())
  doctorId       String   @unique
  weeklySchedule Json
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  doctor         Doctor   @relation(fields: [doctorId], references: [id], onDelete: Cascade)
}

model Leave {
  id        String   @id @default(cuid())
  doctorId  String
  doctor    Doctor   @relation(fields: [doctorId], references: [id], onDelete: Cascade)

  reason    String
  startDate DateTime
  endDate   DateTime

  applyAt   DateTime @default(now())
}

model Admin {
  id        String   @id @default(cuid())
  userId    String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum Gender {
  MALE
  FEMALE
  BINARY
}

enum Specialty {
  CARDIOLOGIST
  DERMATOLOGIST
  PEDIATRICIAN
  NEUROLOGIST
  NEPHROLOGIST
  GASTROENTEROLOGIST
  ENDOCRINOLOGIST
  PULMONOLOGIST
  ONCOLOGIST
  ORTHOPEDIC
  OPHTHALMOLOGIST
  OTOLARYNGOLOGIST
  UROLOGIST
  RHEUMATOLOGIST
  PSYCHIATRIST
  PSYCHOLOGIST
  GENERAL_PHYSICIAN
  GENERAL_SURGEON
  RADIOLOGIST
  PATHOLOGIST
  HEMATOLOGIST
  DENTIST
  GYNECOLOGIST
  OBSTETRICIAN
  PLASTIC_SURGEON
  VASCULAR_SURGEON
  CARDIOTHORACIC_SURGEON
  DERMATOSURGEON
  INFECTIOUS_DISEASE_SPECIALIST
  IMMUNOLOGIST
  ANESTHESIOLOGIST
  EMERGENCY_MEDICINE
  SPORTS_MEDICINE
  PAIN_MEDICINE
  CRITICAL_CARE
  PHYSIOTHERAPIST
  NUTRITIONIST
}

enum Qualification {
  MBBS
  BDS
  BPT
  BHMS
  BAMS
  MD
  MS
  DNB
  MDS
  DM
  MCH
  MPH
  MBA_HM
  PHD
  DO
  FELLOWSHIP
  PGD
}

enum Role {
  PATIENT
  DOCTOR
  ADMIN
}
